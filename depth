#!/usr/bin/env python
import freenect
import matplotlib.pyplot as mp
import numpy
import frame_convert
import signal

keep_running = True


def get_depth():
    depth = frame_convert.pretty_depth(freenect.sync_get_depth()[0])
    #min = depth.argmin()
    #where = numpy.where(depth == min, True, False)
    #count = numpy.count_nonzero(where == True)
    #print min, count
    minloc = numpy.unravel_index(depth.argmin(), depth.shape)
    y = float(minloc[0])/float(depth.shape[0])
    x = float(minloc[1])/float(depth.shape[1])
    print x, y
    return depth


def handler(signum, frame):
    """Sets up the kill handler, catches SIGINT"""
    global keep_running
    keep_running = False


mp.ion()
mp.gray()
mp.figure(1)
image_depth = mp.imshow(get_depth(), interpolation='nearest', animated=True)
print('Press Ctrl-C in terminal to stop')
signal.signal(signal.SIGINT, handler)

while keep_running:
    mp.figure(1)
    image_depth.set_data(get_depth())
    mp.draw()
    mp.waitforbuttonpress(0.01)
